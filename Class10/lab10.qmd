---
title: "Class 10: Halloween Mini Project"
author: "Libby (pid: A69047570 )"
format: pdf
editor: visual
---


## Libraries

```{r, message=FALSE}
library(readr)
library(ggplot2)
library(tidyverse)
```

## Importing candy data

```{r}
candy <- read.csv("candy-data.txt", row.names = 1)
head(candy)

flextable::flextable(head(candy))
```

> q1: how many different candy types are in this dataset?

```{r}
nrow(candy)
```

> q2: how many fruity candy types are in the dataset

```{r}
sum(candy$fruity)
```

## Section 2: what is your favorite candy?

> q3. What is your favorite candy in the dataset and what is it’s winpercent value?

```{r}
candy["Laffy Taffy", ]$winpercent
```

>Q4. What is the winpercent value for “Kit Kat”?

```{r}
candy["Kit Kat", ]$winpercent
```


>Q5. What is the winpercent value for “Tootsie Roll Snack Bars”?

```{r}
candy["Tootsie Roll Snack Bars", ]$winpercent
```

```{r, message=FALSE}
library("skimr")
# skim() function in the skimr package that can help give you a quick overview of a given dataset
skim(candy)
```

> Q6. Is there any variable/column that looks to be on a different scale to the majority of the other columns in the dataset?

winpercent looks like it is on a 0-100% scale whereas the other columns are 0-1.


> Q7. What do you think a zero and one represent for the candy$chocolate column?

They are representing conditionals. TRUE is 1 and FALSE is 0.


A good place to start any exploratory analysis is with a histogram. You can do this most easily with the base R function hist(). Alternatively, you can use ggplot() with geom_hist(). Either works well in this case and (as always) its your choice.

> Q8. Plot a histogram of winpercent values

```{r}

ggplot(candy, aes(x=winpercent)) +
  geom_histogram(bins=20) +
  geom_vline(xintercept = 50, color="red")
```


> Q9. Is the distribution of winpercent values symmetrical?

It's not perfectly symmetrical, let's try a density plot. As you can see it is skewed to the left a bit.
```{r}
ggplot(candy, aes(x=winpercent)) +
  geom_density(bins=20) +
  geom_vline(xintercept = 50, color="red")
```


> Q10. Is the center of the distribution above or below 50%?

Although the mean is above 50 (slightly at 50.3 %) due to outliers, the center of the distribution (median) is below 50% at 47.82%
```{r}
win <- candy$winpercent

summary(win)
```


>Q11. On average is chocolate candy higher or lower ranked than fruit candy?

Chocolate candy is ranked higher than fruit candy on average at a win percent of 60.02% for chocolate compared to 44.12% of fruity candy
```{r}
# 1. Find all chocolate candy in the dataset
# 2. Extract their winpercent values
# 3. Find the mean of the values
chocolate <- candy |> 
  filter(chocolate == 1) |> 
  summary(winpercent)
# Mean :60.92

fruity <- candy |> 
  filter(fruity == 1) |> 
  summary(winpercent)
# Mean :44.12
 
# Alternative:
# 1. Find all chocolate candy in the dataset
choc.inds <- as.logical(candy$chocolate)
choc.candy <- candy[choc.inds, ]
# 2. Extract their winpercent values
choc.win  <- choc.candy$winpercent
# 3. Find the mean of the values
mean(choc.win)


# 1. Find all fruity candy in the dataset
fruity.inds <- as.logical(candy$fruity)
fruity.candy <- candy[fruity.inds, ]
# 2. Extract their winpercent values
fruity.win  <- fruity.candy$winpercent
# 3. Find the mean of the values
mean(fruity.win)
```


> Q12. Is this difference statistically significant?

Yes the answer is statistically significant, so chocolate candy is ranked higher than fruity candy, suggested here by the pvalue of 2.871e-08
```{r}
t.test(choc.win, fruity.win)
```


## 3. Overall Candy Rankings


>Q13. What are the five least liked candy types in this set?

```{r}

# with base R
head(candy[order(candy$winpercent),], n=5)


# with dplyr
candy |>  
  arrange(winpercent) |>  
  head(5)

```


>Q14. What are the top 5 all time favorite candy types out of this set?

```{r}
candy |>  
  arrange(-winpercent) |>  
  head(5)
```
> Q15. Make a first barplot of candy ranking based on winpercent values

```{r}
ggplot(candy) +
  aes(winpercent, rownames(candy)) +
  geom_col()
```


```{r}
x <- c(10,2,5,1)
order(x)

ord.ind <- order(candy$winpercent)
head(candy[ord.ind, ], 5)
```

> Q16. This is quite ugly, use the reorder() function to get the bars sorted by winpercent?

```{r}
ggplot(candy) +
  aes(winpercent, reorder(rownames(candy), winpercent)) +
  geom_col()
```

```{r}
my_cols=rep("black", nrow(candy))
my_cols[as.logical(candy$chocolate)] = "chocolate"
my_cols[as.logical(candy$bar)] = "brown"
my_cols[as.logical(candy$fruity)] = "pink"
```

```{r}
ggplot(candy) + 
  aes(winpercent, reorder(rownames(candy),winpercent)) +
  geom_col(fill=my_cols) 
```


> Q17. What is the worst ranked chocolate candy?

Sixlets are the worst ranked chocolate candy!
```{r}
my_cols <- rep("black", nrow(candy))
candy$chocolate==1
my_cols

ggplot(candy) +
  aes(winpercent, reorder(rownames(candy),winpercent)) +
  geom_col(fill=my_cols) 


```

> Q18. What is the best ranked fruity candy?

Starburst is the best ranked fruity candy!

# Section 4
## Winpercent v PricePercent

> Q19. Which candy type is the highest ranked in terms of winpercent for the least money - i.e. offers the most bang for your buck?

The fruity candies offer more band for your buck, with Starburst seeming to be the highest ranked for best cost, reeses miniatures may contend with it too, but it does have a slightly higher price percent.
```{r}

library(ggrepel)
ggplot(candy) +
  aes(winpercent, pricepercent, label=rownames(candy)) +
  geom_point(col=my_cols) +
  geom_text_repel(col=my_cols)
```

> Q20. What are the top 5 most expensive candy types in the dataset and of these which is the least popular?

```{r}
ord <- order(candy$pricepercent, decreasing = TRUE)
head( candy[ord,c(11,12)], n=5 )
```

## Correlation structure

> Q22. Examining this plot what two variables are anti-correlated (i.e. have minus values)?

fruity and chocolate are anti-correlated, also pluribus and bar but less so than fruity and chocolate 
```{r}
cij <- cor(candy) # takes all cols in dataset, so an nxn correlation matrix
```

```{r}
library(corrplot)
corrplot(cij)
```

> Q23. Similarly, what two variables are most positively correlated?

Aside from the 1:1 match, when items are paired against themselves, chocolate and winpercent are most positively correlated.

# 6. Principal Component Analysis

The main function in base R for this `prcomp()` remember it has a scale parameter you basically always want to use; `scale=TRUE`

```{r}
pca <- prcomp(candy, scale=TRUE)
summary(pca)
```

Let's first look at our first main result figure - the "PC Plot" or PC1 v PC2 plot

```{r}
ggplot(pca$x) + # shows where candies lie
  aes(PC1, PC2, label=rownames(pca$x)) +
  geom_point(col=my_cols) +
  geom_text_repel(col=my_cols) +
  labs(title = "Barry's candy space map")
```

Don't forget about your variable loadings -- how the original variables contribute to your new PCs....

> Q24. What original variables are picked up strongly by PC1 in the positive direction? Do these make sense to you?

Fruity, hard, and pluribus are most strongly picked up by PC1 in the positive direction. This makes sense because most fruity candy does seem to be hard, and because it is cheaper comes in multiples more than chocolate candy.

```{r}
ggplot(pca$rotation) +
  aes(PC1, rownames(pca$rotation)) +
  geom_col()
```


